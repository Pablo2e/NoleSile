<!-- MENSAJES -->

<!-- HEADER Y CATEGORIAS -->
<app-header></app-header>
<app-categories></app-categories>

<!-- TÍTULO -->
<div class="container-fluid">

  <div class="row">

    <div class="col text-success mt-5 mb-5 text-center">
      <h2>Noles</h2>
    </div>

  </div>

</div>


<!-- CONTENEDOR NOLES -->
<div class="container-fluid mb-5 ">

  <div class="row d-flex justify-content-center">

    <div class="col-10 border border-success ">

      <div class="row align-items-end d-flex justify-content-center">

        <!--TARJETA-->
        <div 
          class="card border-0 mb-2" 
          style="width: 18rem; height: 450px" 
          *ngFor="let nole of noles"
        >

          <img 
            class="card-img-top m-auto " 
            src="{{nole.product_image}}" 
            alt="Foto del producto"
            style="max-width: 200px; max-height: 200px"
          >

          <div class="card-block ml-2 mr-2 text-center">

            <h4 class="card-title">{{nole.nombre}}</h4>

            <button 
              type="button" 
              class="btn btn-outline-success btn-sm mr-1" 
              (click)="pasarIdOwner(nole.user_id)" 
              [routerLink]="['/propietario']"
            >
              <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                {{nole.name}}
            </button>

            <button 
              *ngIf="nole.num_mensajes_nuevos>0" 
              type="button" 
              class="btn btn-danger btn-sm ml-1" 
              (click)="cambiarMensajeALeido(nole.chat_id)" 
              (click)="openModal(modalMensajeNoles)" 
              (click)="pasarNole(nole)"
            >
              <i class="fa fa-envelope-open" aria-hidden="true"></i>
                {{nole.num_mensajes_nuevos}} mensajes nuevos
            </button>

            <button 
              *ngIf="nole.num_mensajes_nuevos<=0" 
              type="button" 
              class="btn btn-outline-success btn-sm ml-1"
              (click)="openModal(modalMensajeNoles)" 
              (click)="pasarNole(nole)"
            >
              <i class="fa fa-envelope-open" aria-hidden="true"></i>
                Mensajes
            </button>

            <p class="card-text"></p>

          </div>

          <div class="mt-3 mb-3 d-flex justify-content-center">

            <button 
              type="button" 
              class="btn btn-outline-danger btn-sm" 
              (click)="pasarNoleParaBorrar(nole.chat_id)" 
              (click)="openModal(modalBorrarNole)"
            >
              <i class="fa fa-trash" aria-hidden="true"></i>
                Borrar nole
            </button>

          </div>     

        </div>

        <!-- DIV UNICORIO -->
        <div *ngIf="noles.length!=0; else noHayNoles"></div>
        <ng-template #noHayNoles> 

          <img 
            class="mt-3 mb-2" 
            src="http://localhost:3100/unicornio.png" 
            alt="Unicornio"
          >
          
          <div class="display-4 text text-success text-center mb-2" >
            No tienes noles... pero mira que bonito unicornio
          </div>

        </ng-template>

      </div>

    </div>

  </div>

</div> 

<div class="container-fluid">

  <div class="row">

    <div class="col text-success mb-5 text-center">
      <h2>Siles</h2>
    </div>

  </div>

</div>

<!-- CONTENEDOR SILES -->
<div class="container-fluid mb-5 ">

  <div class="row d-flex justify-content-center">

    <div class="col-10 border border-success ">

      <div class="row align-items-end d-flex justify-content-center">

        <!--TARJETA-->
        <div 
          class="card border-0 mt-2" 
          style="width: 18rem; height: 450px" 
          *ngFor="let sile of siles"
        >

          <img 
            class="card-img-top m-auto" 
            src="{{sile.product_image}}" 
            alt="Card image cap"
            style="max-width: 200px; max-height: 200px"
          >

          <div class="card-block ml-2 mr-2 text-center">

            <h4 class="card-title">{{sile.nombre}}</h4>

            <button 
              type="button" 
              class="btn btn-outline-success btn-sm mr-1" 
              (click)="pasarIdOwner(sile.user_id)" 
              [routerLink]="['/propietario']"
            >
              <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                {{sile.name}}
            </button>

            <button 
              *ngIf="sile.num_mensajes_nuevos>0" 
              type="button" 
              class="btn btn-danger btn-sm ml-1" 
              (click)="cambiarMensajeALeido(sile.chat_id)" 
              (click)="openModal(modalMensajeSiles)" 
              (click)="pasarSile(sile)"
            >
              <i class="fa fa-envelope-open" aria-hidden="true"></i>
                {{sile.num_mensajes_nuevos}} mensajes nuevos
            </button>

            <button 
              *ngIf="sile.num_mensajes_nuevos<=0" 
              type="button" 
              class="btn btn-outline-success btn-sm ml-1" 
              (click)="openModal(modalMensajeSiles)" 
              (click)="pasarSile(sile)"
            >
              <i class="fa fa-envelope-open" aria-hidden="true"></i>
                Mensajes
            </button>

            <p class="card-text"></p>

          </div>

          <div class="mt-3 mb-3 d-flex justify-content-center">

            <button 
              type="button" 
              class="btn btn-outline-danger btn-sm" 
              (click)="pasarNoleParaBorrar(sile.chat_id)" 
              (click)="openModal(modalBorrarSile)"
            >
              <i class="fa fa-trash" aria-hidden="true"></i>
                Borrar sile
            </button>

          </div> 

        </div>

        <!-- DIV UNICORIO -->
        <div *ngIf="siles.length!=0; else noHaySiles"></div>
        <ng-template #noHaySiles > 

          <img 
            class="mt-3 mb-2" 
            src="http://localhost:3100/unicornio.png" 
            alt="Unicornio"
          >

          <div class="display-4 text text-success text-center mb-2" >
            No tienes siles... pero mira que bonito unicornio
          </div>

        </ng-template>

      </div>

    </div>

  </div>

</div> 

<!-- MODALES -->
<!-- MODAL ELIMINAR NOLE -->
<ng-template #modalBorrarNole>

  <div class="modal-body text-success text-center">

    <form>

      <div class="form-group">

        <label for="recipient-name" class="col-form-label">
          <h3>¿Seguro que quieres borrar tu Nole?</h3>
        </label>

      </div>

    </form>

  </div>

  <div class="d-flex justify-content-center mb-3">

    <button 
      type="button" 
      class="btn btn-outline-danger" 
      (click)="eliminarNole()" 
      (click)="modalRef.hide()"
      [routerLink]="['/mensajes']" 
    >
      Borrar Nole
    </button>

  </div>

</ng-template>

<!-- MODAL ELIMINAR SILE -->
<ng-template #modalBorrarSile>

  <div class="modal-body text-success text-center">

    <form>

      <div class="form-group">

        <label for="recipient-name" class="col-form-label">
          <h3>¿Seguro que quieres borrar tu Sile?</h3>
        </label>

      </div>

    </form>

  </div>

  <div class="d-flex justify-content-center mb-3">

    <button 
      type="button" 
      class="btn btn-outline-danger" 

      (click)="eliminarNole()" 
      [routerLink]="['/mensajes']" 
      (click)="modalRef.hide()"
    >
      Borrar Sile
    </button>

  </div>

</ng-template>

<!-- MODAL MENSAJE NOLES -->
<ng-template #modalMensajeNoles>

  <div class="modal-body text-dark">

    <div class="col-12 align-self-end mt-5 mb-5 ">

      <div class="media media-chat ml-4 mr-3" *ngFor="let messageN of messagesNoles">

        <div class="media-body">

          <div class="media-body letraColor"><b>{{messageN.name}}:</b> {{messageN.text}} <br>
            <p class="text-right letraChica">{{messageN.date}}</p>
            <hr>
          </div>

        </div>

      </div>

    </div>

    <div class="container">

      <form #uploadForm="ngForm" (ngSubmit)="onSubmit(uploadForm);">

        <div class="input-group input-group-sm mt-2 mb-3" >

          <input 
            type="text" 
            class="form-control border border-success" 
            id="mensaje" 
            placeholder="Mensaje"
            name="mensaje" 
            aria-label="Recipient's username" 
            aria-describedby="button-addon2" 
            name="text"
            [(ngModel)]="message.text" 
            #text="ngModel" 
            required 
            (keyup.enter)="enviarMsgNoleSeleccionado(text.value)"
            (keyup.enter)="this.text.reset()"
          >
          <div class="input-group-append">
            <button 
              class="btn btn-success" 
              type="button" 
              id="button-addon2"
              (click)="enviarMsgNoleSeleccionado(text.value)" 
              (click)="this.text.reset()"
            >
              <i class="fa fa-comments" aria-hidden="true"></i>
                Enviar Mensaje
            </button>

          </div>

        </div>

      </form>

    </div>

  </div>  

  <div class="d-flex justify-content-center mb-3">

    <button 
      type="button" 
      class="btn btn-outline-success" 
      (click)="modalRef.hide()" 
      (click)=cargarNoles()
    >
      Cerrar
    </button>

  </div>

</ng-template>

<!-- MODAL MENSAJE SILES -->
<ng-template #modalMensajeSiles>

  <div class="modal-body text-dark">

    <div class="col-12 align-self-end mt-5 mb-5 ">

      <div class="media media-chat ml-4 mr-3" *ngFor="let messageS of messagesSiles">

        <div class="media-body">

          <div class="media-body letraColor"><b>{{messageS.name}}:</b> {{messageS.text}} <br>
            <p class="text-right letraChica">{{messageS.date}}</p>
            <hr>
          </div>

        </div>

      </div>

    </div>

    <div class="container">
      
      <form #uploadForm="ngForm" (ngSubmit)="onSubmit(uploadForm);">

        <div class="input-group input-group-sm mt-2 mb-3">

          <input 
            type="text" 
            class="form-control border border-success" 
            id="mensaje2" 
            placeholder="Mensaje"
            name="mensaje2" 
            aria-label="Recipient's username" 
            aria-describedby="button-addon2" 
            name="text2"
            [(ngModel)]="message2.text" 
            #text2="ngModel" 
            required 
            (keyup.enter)="enviarMsgSileSeleccionado(text2.value)"
            (keyup.enter)="this.text2.reset()"
          >
          <div class="input-group-append">
            <button 
              class="btn btn-success" 
              type="button" 
              id="button-addon2"
              (click)="enviarMsgSileSeleccionado(text2.value)" 
              (click)="this.text2.reset()" 
            >
              <i class="fa fa-comments" aria-hidden="true"></i>
                Enviar Mensaje
            </button>

          </div>

        </div>

      </form>

    </div>

  </div>

  <div class="d-flex justify-content-center mb-3">

    <button 
      type="button" 
      class="btn btn-outline-success" 
      (click)="modalRef.hide()" 
      (click)=cargarSiles()
    >
      Cerrar
    </button>

  </div>
  
</ng-template>

<!-- Footer -->
<app-footer></app-footer>

